CLI_NAME=ccwc

.PHONY: install-tools
install-tools:
	go install mvdan.cc/gofumpt@latest
	go install golang.org/x/tools/cmd/goimports@latest
	go install gotest.tools/gotestsum@v1.11.0

.PHONY: fmt
fmt: install-tools ## Formats all go files
	gofumpt -l -w -extra  .
	find . -type f -name '*.go' -exec grep -L -E 'Code generated by .*\. DO NOT EDIT.' {} + | xargs goimports -format-only -w -local=github.com/shubhammehra4

.PHONY: lint
lint: fmt ## Run golang linter. Requires golangci-lint to be installed on the system
	golangci-lint run -v --timeout 8m

.PHONY: test
test:
	@echo "Run for the tests"
	@cd ./tests && go test -v --tags=integration -p 4 --test.timeout=1h

.PHONY: unit-test
unit-test: install-tools
	gotestsum --format pkgname-and-test-fails -- -v ./... --tags=unit -vet=all

.PHONY: build
build: 
	go build -o $(CLI_NAME)